[pylithapp]

# ----------------------------------------------------------------------
# problem
# ----------------------------------------------------------------------
[pylithapp.timedependent]
implicit.solver = pylith.problems.SolverNonlinear

[pylithapp.timedependent.implicit.time_step]
dt = 2.0*year

# ----------------------------------------------------------------------
# materials
# ----------------------------------------------------------------------
# Change material type to Drucker-Prager
[pylithapp.timedependent]
materials = [plastic]
materials.plastic = pylith.materials.DruckerPrager3D

[pylithapp.timedependent.materials.plastic]
label = Plastic material
id = 1
db_properties.label = Properties for plastic material
db_properties.iohandler.filename = ../spatialdb/mat_plastic.spatialdb
quadrature.cell = pylith.feassemble.FIATLagrange
# quadrature.cell = pylith.feassemble.FIATSimplex
quadrature.cell.dimension = 3
output.cell_info_fields = [density,mu,lambda,alpha_yield,beta,alpha_flow]
output.cell_data_fields = [total_strain,stress,plastic_strain]

# Initial stresses.
db_initial_stress = spatialdata.spatialdb.SimpleDB
db_initial_stress.label = Initial stress for material
db_initial_stress.iohandler.filename = ../spatialdb/initial_stress.spatialdb
db_initial_stress.query_type = nearest

# ----------------------------------------------------------------------
# boundary conditions
# ----------------------------------------------------------------------
[pylithapp.timedependent]
bc = [x_neg,x_pos,y_neg,y_pos,z_neg,z_pos]

[pylithapp.timedependent.bc.x_neg]
label = face_xneg
bc_dof = [0,1]
db_initial = pylith.bc.ZeroDispDB
db_initial.label = Dirichlet initial BC on x_neg

db_rate = spatialdata.spatialdb.SimpleDB
db_rate.label = Linear displacement-rate ramp on x_neg
db_rate.iohandler.filename = ../spatialdb/x_velbc.spatialdb
db_rate.query_type = linear

[pylithapp.timedependent.bc.x_pos]
label = face_xpos
bc_dof = [0,1]
db_initial = pylith.bc.ZeroDispDB
db_initial.label = Dirichlet initial BC on x_pos

db_rate = spatialdata.spatialdb.SimpleDB
db_rate.label = Linear displacement-rate ramp on x_pos
db_rate.iohandler.filename = ../spatialdb/x_velbc.spatialdb
db_rate.query_type = linear

[pylithapp.timedependent.bc.y_neg]
label = face_yneg
bc_dof = [0,1]
db_initial = pylith.bc.ZeroDispDB
db_initial.label = Dirichlet initial BC on y_neg

[pylithapp.timedependent.bc.z_neg]
label = face_zneg
bc_dof = [2]
db_initial = pylith.bc.ZeroDispDB
db_initial.label = Dirichlet initial BC on z_neg

[pylithapp.timedependent.bc.z_pos]
label = face_zpos
bc_dof = [2]
db_initial = pylith.bc.ZeroDispDB
db_initial.label = Dirichlet initial BC on z_pos

[pylithapp.timedependent.bc.y_pos]
label = face_ypos
bc_dof = [0,1]
db_initial = pylith.bc.ZeroDispDB
db_initial.label = Dirichlet initial BC on y_pos

db_rate = spatialdata.spatialdb.UniformDB
db_rate.label = Constant velocity BC on y_pos
db_rate.values = [displacement-rate-x,displacement-rate-y,rate-start-time]
db_rate.data = [0.8888888888889*m/year,0.0*m/year,0.0*year]

# ----------------------------------------------------------------------
# output
# ----------------------------------------------------------------------
[pylithapp.problem.formulation.output.domain]
writer.filename = ../output/plastic_sshear_dt02-domain.h5

[pylithapp.timedependent.materials.plastic.output]
cell_filter = pylith.meshio.CellFilterAvg
writer = pylith.meshio.DataWriterHDF5
writer.filename = ../output/plastic_sshear_dt02-plastic.h5
